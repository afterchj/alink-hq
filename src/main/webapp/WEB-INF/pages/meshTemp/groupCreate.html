<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <script src="/alink-hq/static/js/browser.js"></script>
    <link rel="stylesheet" href="/alink-hq/static/css/base.css"/>
    <link rel="stylesheet" href="/alink-hq/static/css/leftNav.css"/>
    <link rel="stylesheet" href="/alink-hq/static/css/loding.css"/>
    <link rel="stylesheet" href="/alink-hq/static/css/projectManage.css"/>
    <link rel="stylesheet" th:href="@{/static/css/laydate.css}"/>
    <title>创建组</title>
</head>
<body>
<div th:replace="common/head::head"></div>
<div class="c-container">
    <div th:replace="common/left::left"></div>
    <div class="main-right">
        <div class="clearfix main-right-nav">
            <div class="f-l main-right-title">创建组</div>
            <!--<div class="f-r pointer">-->
            <!--<img src="/alink-hq/static/img/create-project.png" alt="">-->
            <!--</div>-->
            <div class="f-r pointer">
                <div class="goBack" onClick="javascript :history.back();">
                    <span><</span><span>返回</span>
                </div>
                <!--<img src="/alink-hq/static/img/go-back.png" alt="" onclick="history.back()">-->
            </div>
        </div>
        <div id="createProject">
            <div class="c-createProject">
                <div class="c-nav">
                    创建组
                </div>
                <div class="c-content ">
                    <div class="subjection">隶属项目：<span th:inline="text">[[${project.label}]]</span></div>
                    <form th:action="@{/group/save}" method="GET"  style="margin-top: 0;">
                        <div class="process clearfix">
                            <div class="f-l part">
                                <img src="/alink-hq/static/img/fill-1-on.png" alt="" id="one-step">
                                <span>选择网络</span>
                            </div>
                            <div class="f-l part  line ">……</div>
                            <div class="f-l part">
                                <img src="/alink-hq/static/img/fill-2-no.png" alt="" id="two-step">
                                <span>选择区域</span>
                            </div>
                            <div class="f-l part  line ">……</div>
                            <div class="f-l part">
                                <img src="/alink-hq/static/img/fill-3-no.png" alt="" id="three-step">
                                <span>输入名称</span>
                            </div>
                        </div>
                        <!--选择网络-->
                        <div class="select-mesh-step active step">
                            <div>
                                <p class="project-hint"></p>
                                <label for="mid">选择网络：</label>
                                <select id="mid" name="mid" style="height:35px;">
                                    <option value="">请选择网络</option>
                                </select>
                            </div>
                            <div>
                                <p class="" style="height: 35px"></p>
                                <label for="meshId">网络ID：</label>
                                <input type="text" id="meshId">
                            </div>
                            <div class="">
                                <button type="button" class="confirm-create" openTab="confirm-create">下一步</button>
                            </div>
                        </div>

                        <!--选择区域-->
                        <div class="select-place-step step">
                            <div>
                                <p class="place-hint"></p>
                                <label for="place">选择区域：</label>
                                <select id="place" name="place" style="height:35px;">
                                    <option value="">请选择区域</option>
                                </select>
                            </div>

                            <div class="">
                                <button type="button" class="back-btn" >上一步</button>
                                <button type="button" class="confirm-create" openTab="confirm-create">下一步</button>
                            </div>
                        </div>

                        <!--输入组名-->
                        <div class="select-group-step step">
                            <div>
                                <p class="group-hint"></p>
                                <label for="group">组名：</label>
                                <input type="text" id="group" placeholder="请输入（2-16 位汉字、字母、数字）">
                            </div>
                            <div class="">
                                <button type="button" class="back-btn" >上一步</button>
                                <button type="button" class="confirm-create" openTab="confirm-create">下一步</button>
                            </div>
                        </div>

                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="preload-anim">
    <div id="circularG">
        <div id="circularG_1" class="circularG"></div>
        <div id="circularG_2" class="circularG"></div>
        <div id="circularG_3" class="circularG"></div>
        <div id="circularG_4" class="circularG"></div>
        <div id="circularG_5" class="circularG"></div>
        <div id="circularG_6" class="circularG"></div>
        <div id="circularG_7" class="circularG"></div>
        <div id="circularG_8" class="circularG"></div>
    </div>
    <p class="title"></p>
</div>
<script type="text/javascript" src="/alink-hq/static/js/jquery.min.js"></script>
<script type="text/javascript" src="/alink-hq/static/js/left.js"></script>
<script th:inline="javascript">
    var uid = [[${session.user.id}]];
    var mid,pid,meshId,placeIds;
    $(function () {
        var tabs = "groupList"
        var index = 0
        left(tabs, index)
        $.getJSON("/alink-hq/group/getMesh", {"uid": uid}, function (json) {
            if (json != '') {
                $("#mid option:first").siblings().remove()
            }
            // 下面使用each进行遍历
            $.each(json, function (i, item) {
                $("#mid").append("<option value='" + item.id + "'>" + item.label + "</option>");
            });
            var str = $("#mid option:selected").val()
            $("#meshId").val(str.substr(0,str.indexOf("_")))
            $("#mid").change(function () {
                 mid = $("#mid option:selected").val()
                if(mid==''){
                    $('.project-hint').text('请选择网络')
                }else{
                    $('.project-hint').text('')
                }
                 meshId = mid.substr(mid.indexOf("_") + 1)
//                console.log("mid=" + mid + ",meshId=" + meshId);
                $("#meshId").val(meshId);
            })
        })
    })
    //选择网络后下一步
    $('.select-mesh-step .confirm-create').click(function(){
         mid = $("#mid option:selected").val()
        if(mid==''){
            $('.project-hint').text('请选择网络')
        }else{
            $('.project-hint').text('')
            $('#one-step').attr('src','/alink-hq/static/img/fill-1-is.png')
            $('#two-step').attr('src','/alink-hq/static/img/fill-2-on.png')
            $('#three-step').attr('src','/alink-hq/static/img/fill-3-no.png')
            $('.select-place-step').addClass('active').siblings('.step').removeClass('active')
            $.getJSON("/alink-hq/group/getPlace", {"uid": uid}, function (json) {
                if (json != '') {
                    $("#place option:first").siblings().remove();
                }
                // 下面使用each进行遍历
                $.each(json, function (i, item) {
                    $("#place").append("<option value='" + item.id + "'>" + item.label + "</option>")
                });
                var str = $("#place option:selected").val()
                $("#place").val(str.substr(0,str.indexOf("_")))
                $("#place").change(function () {
                     pid = $("#place option:selected").val()
                    if(pid==''){
                        $('.place-hint').text('请选择区域')
                    }else{
                        $('.place-hint').text('')
                    }
//                     placeIds = pid.substr(pid.indexOf("_") + 1)
//                    $("#place").val(placeIds);
                })
            })
        }
    })
    //选择区域后下一步
    $('.select-place-step .confirm-create').click(function(){
         pid = $("#place option:selected").val()
        if(pid==''){
            $('.place-hint').text('请选择区域')
        }else{
            $('.place-hint').text('')
            $('#one-step').attr('src','/alink-hq/static/img/fill-1-is.png')
            $('#two-step').attr('src','/alink-hq/static/img/fill-2-is.png')
            $('#three-step').attr('src','/alink-hq/static/img/fill-3-on.png')
            $('.select-group-step').addClass('active').siblings('.step').removeClass('active')
            $("#group").bind("input propertychange",function () {
                var groupId=$('#group').val()
                var regName = /^[a-zA-Z0-9\u4e00-\u9fa5]{2,16}$/
                var groupResult = regName.test(groupId)

                if(groupId!='' && groupResult){
                    $('.group-hint').text('')
                }else{
                    $('.group-hint').text('请输入（2-16 位汉字、字母、数字）')
                }
            })
        }
    })
    //选择区域后上一步
    $('.select-place-step .back-btn').click(function(){
        $('#one-step').attr('src','/alink-hq/static/img/fill-1-on.png')
        $('#two-step').attr('src','/alink-hq/static/img/fill-2-no.png')
        $('#three-step').attr('src','/alink-hq/static/img/fill-3-no.png')
        $('.select-mesh-step').addClass('active').siblings('.step').removeClass('active')
        $("#meshId").val(meshId);
        $("#mid option:selected").val(mid)
    })
    //输入组的确定
    $('.select-group-step .confirm-create').click(function(){
        var groupId=$('#group').val()
        var regName = /^[a-zA-Z0-9\u4e00-\u9fa5]{2,16}$/
        var groupResult = regName.test(groupId)
        console.log('groupId',groupId,'mid',mid,'pid',pid)
        if(groupId!='' && groupResult){
            $('.group-hint').text('')
            $.ajax({
                type: "post",
                url: "/alink-hq/group/save",
                data: {mid:mid, pid:pid,name:groupId},
                sucess: function(res){
                    console.log(res);
                }
            })
        }else{
            $('.group-hint').text('请输入（2-16 位汉字、字母、数字）')
        }
    })
    //输入组的上一步
    $('.select-group-step .back-btn').click(function(){
        $('#one-step').attr('src','/alink-hq/static/img/fill-1-is.png')
        $('#two-step').attr('src','/alink-hq/static/img/fill-2-on.png')
        $('#three-step').attr('src','/alink-hq/static/img/fill-3-no.png')
        $('.select-place-step').addClass('active').siblings('.step').removeClass('active')
//        $("#meshId").val(meshId);
        $("#place option:selected").val(pid);
    })
    //监听网络选择
//    $('#mid').change(function(){
//        var mid = $('#pid option:selected').val();
//        if(mid==''){
//            $('.project-hint').text('请选择网络');
//        }else{
//            $('.project-hint').text('');
//        }
//    })
</script>
</body>
</html>